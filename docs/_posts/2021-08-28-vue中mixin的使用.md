---
layout: post
title:  "vue中mixin的使用"
date:   2021-08-28
categories: Vue
tags: Vue
---

### mixins定义

mixins是对vue组件的一种扩展，将一些公用的常用数据或者方法，构建一个可被混入的数据结构，被不同的vue组件进行合并，就可以在不同的vue组件中使用相同的方法或者基础数据。

### 选项合并

当组件和混入对象含有同名选项时，这些选项将以恰当的方式进行“合并”。

- 数据对象在内部会进行递归合并，并在发生冲突时以组件数据优先。

```
var mixin = {
  data: function () {
    return {
      message: 'hello',
      foo: 'abc'
    }
  }
}

new Vue({
  mixins: [mixin],
  data: function () {
    return {
      message: 'goodbye',
      bar: 'def'
    }
  },
  created: function () {
    console.log(this.$data)
    // => { message: "goodbye", foo: "abc", bar: "def" }
  }
})

```

- 同名钩子函数将合并为一个数组，因此都将被调用。另外，混入对象的钩子将在组件自身钩子之前调用。

```
var mixin = {
  created: function () {
    console.log('混入对象的钩子被调用')
  }
}

new Vue({
  mixins: [mixin],
  created: function () {
    console.log('组件钩子被调用')
  }
})

// => "混入对象的钩子被调用"
// => "组件钩子被调用"

```

- 值为对象的选项，例如 methods、components 和 directives，将被合并为同一个对象。两个对象键名冲突时，取组件对象的键值对。

```
var mixin = {
  methods: {
    foo: function () {
      console.log('foo')
    },
    conflicting: function () {
      console.log('from mixin')
    }
  }
}

var vm = new Vue({
  mixins: [mixin],
  methods: {
    bar: function () {
      console.log('bar')
    },
    conflicting: function () {
      console.log('from self')
    }
  }
})

vm.foo() // => "foo"
vm.bar() // => "bar"
vm.conflicting() // => "from self"

```

### 对于混入组件 和 主组件中的相关冲突

- 对于方法来说，主组件中的方法会覆盖掉混入组件的方法（名字相同时）
- 对于生命周期相同时，会将其合并在一个里面，对应周期里的名字相同时，也会被覆盖
- 混合对象里的钩子函数在主组件里的钩子函数之前调用；
- 钩子函数相同时，混入对象函数中的console会在主组件里的钩子函数之前调用；

### 与vuex的区别

vuex：用来做状态管理的，里面定义的变量在每个组件中均可以使用和修改，
在任一组件中修改此变量的值之后，其他组件中此变量的值也会随之修改。

Mixins：可以定义共用的变量，在每个组件中使用，引入组件中之后，
各个变量是相互独立的，值的修改在组件中不会相互影响。

### mixins的实践应用

状态码统一过滤：

- 创建一个 config.js 文件，用于保存状态码对应的含义，将其暴露出去

  ```
  export const typeConfig = {
    1: "type one",
    2: "type two",
    3: "type three"
  }
  ```

- 创建一个 filters.js 文件，用于保存所有的自定义函数

  ```
  import { typeConfig } from "./config"
  export default {
    filters: {
      $_filterType: (value) => {
        return typeConfig[value] || "type undefined"
      }
    }
  }
  ```

- 在 main.js 中引入我们的 filters 方法集

  ```
  import filter from "./filters"
  Vue.mixin(filter)
  ```

- 在 .vue 的模板文件中随意使用自定义函数了

  ```
  <template>
    <div>{{typeStatus | $_filterType}}<div>
  </template>
  ```